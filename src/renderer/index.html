<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Automation</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro", sans-serif;
      background-color: #111111;
      color: #ffffff;
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }

    :root {
      --accent-color: #e39d4d;
    }

    .app-container {
      display: flex;
      height: calc(100vh - 28px);
    }

    .sidebar {
      width: 72px;
      height: 100%;
      background-color: #0C0C0C;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      background-color: var(--accent-color);
      border-radius: 8px;
      margin-bottom: 40px;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      flex-grow: 1;
    }

    .sidebar-nav-item {
      width: 28px;
      height: 28px;
      background-color: #555;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .sidebar-nav-item.active {
      background-color: var(--accent-color);
    }

    .main-content {
      flex-grow: 1;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .content-area {
      background-color: #1A1A1A;
      border-radius: 12px;
      padding: 20px;
      height: calc(100% - 80px);
      overflow: auto;
    }

    .status-bar {
      height: 28px;
      background-color: #0A0A0A;
      display: flex;
      padding: 0 12px;
      align-items: center;
      font-size: 12px;
      color: #666;
    }

    .status-item {
      margin-right: 16px;
    }

    .upload-button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
    }
    
    /* Upload Form Styles */
    .upload-form {
      max-width: 800px;
      margin: 0 auto;
    }

    .form-section {
      margin-bottom: 32px;
      background-color: #222;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #333;
    }

    .form-section h3 {
      margin-top: 0;
      margin-bottom: 16px;
      font-weight: 500;
      color: #fff;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #ddd;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      background-color: #333;
      border: 1px solid #444;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(227, 157, 77, 0.2);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 80px;
    }

    .file-drop-area {
      border: 2px dashed #444;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      background-color: #2a2a2a;
      transition: all 0.2s;
      cursor: pointer;
    }

    .file-drop-area:hover {
      border-color: var(--accent-color);
      background-color: #2d2d2d;
    }

    .file-message {
      margin-bottom: 16px;
      color: #aaa;
    }

    .secondary-button {
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .secondary-button:hover {
      background-color: #444;
    }

    .selected-file-info {
      display: flex;
      align-items: center;
      margin-top: 16px;
      background-color: #333;
      border-radius: 8px;
      padding: 12px;
      text-align: left;
    }

    .file-icon {
      font-size: 24px;
      margin-right: 12px;
    }

    .file-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .file-meta {
      color: #aaa;
      font-size: 12px;
    }

    .thumbnail-section {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .thumbnail-preview {
      width: 280px;
      height: 158px;
      margin-bottom: 16px;
      background-color: #333;
      border-radius: 8px;
      overflow: hidden;
    }

    .thumbnail-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #777;
    }

    .placeholder-thumbnail {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: bold;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
    }

    .checkbox-group label {
      margin-bottom: 0;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .checkbox-group input[type="checkbox"] {
      margin-right: 8px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    .primary-button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .primary-button:hover {
      filter: brightness(110%);
    }

    .primary-button:disabled {
      background-color: #555;
      cursor: not-allowed;
      filter: brightness(100%);
    }

    .cancel-button {
      background-color: transparent;
      color: #ccc;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .cancel-button:hover {
      background-color: #2a2a2a;
    }

    .upload-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
  }
  
  .overlay-container {
    width: 400px;
    background-color: #1A1A1A;
    border-radius: 16px;
    padding: 24px;
    position: relative;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }
  
  .overlay-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 24px;
    height: 24px;
    border-radius: 12px;
    background-color: #333;
    color: #999;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 18px;
  }
  
  .progress-section {
    display: flex;
    align-items: center;
    margin: 24px 0;
  }
  
  .progress-circle {
    width: 64px;
    height: 64px;
    position: relative;
    margin-right: 20px;
  }
  
  svg.progress-svg {
    transform: rotate(-90deg);
    width: 100%;
    height: 100%;
  }
  
  circle.progress-circle-bg {
    stroke: #333;
    fill: none;
    stroke-width: 4;
  }
  
  circle.progress-circle-fill {
    stroke: var(--accent-color);
    fill: none;
    stroke-width: 4;
    stroke-dasharray: 301;
    stroke-dashoffset: 301;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.5s ease;
  }
  
  .progress-details {
    flex-grow: 1;
  }
  
  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    font-weight: 500;
  }
  
  .upload-file {
    font-weight: 500;
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 250px;
  }
  
  .upload-status {
    margin-bottom: 4px;
  }
  
  .upload-time {
    font-size: 12px;
    color: #999;
  }
  
  /* Drag & Drop Styles */
  .file-drop-area.drag-over {
    border-color: var(--accent-color);
    background-color: #333;
  }

  /* Settings-Page Styles */
  .settings-page {
    max-width: 800px;
    margin: 0 auto;
  }
  
  .auth-status {
    display: flex;
    align-items: center;
    margin: 16px 0;
  }
  
  .status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
  }
  
  .status-indicator.connected {
    background-color: #4CAF50;
  }
  
  .status-indicator.disconnected {
    background-color: #F44336;
  }

  /* Success & Error Styles */
  .success-animation {
    display: flex;
    justify-content: center;
    margin: 32px 0;
  }
  
  .success-checkmark {
    width: 64px;
    height: 64px;
    background-color: var(--accent-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: white;
    animation: scaleIn 0.5s ease;
  }
  
  @keyframes scaleIn {
    0% { transform: scale(0); }
    70% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  
  .success-actions {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 24px;
  }

  .error-animation {
    display: flex;
    justify-content: center;
    margin: 32px 0;
  }
  
  .error-icon {
    width: 64px;
    height: 64px;
    background-color: #ff453a;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: bold;
    color: white;
  }
  
  .error-message {
    background-color: #2a2a2a;
    border-radius: 8px;
    padding: 12px;
    margin: 16px 0;
    color: #ff453a;
  }
  
  .error-actions {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 24px;
  }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Seitenleiste -->
    <div class="sidebar">
      <div class="sidebar-logo"></div>
      <nav class="sidebar-nav">
        <div class="sidebar-nav-item active" data-page="Dashboard"></div>
        <div class="sidebar-nav-item" data-page="Upload"></div>
        <div class="sidebar-nav-item" data-page="Schedule"></div>
        <div class="sidebar-nav-item" data-page="Analytics"></div>
      </nav>
      <div class="sidebar-nav-item" id="settings-nav" data-page="Settings"></div>
    </div>
    
    <!-- Hauptbereich -->
    <div class="main-content">
      <header class="header">
        <h1 class="page-title">Dashboard</h1>
        <button class="upload-button" id="new-upload-btn">New Upload</button>
      </header>
      
      <div class="content-area">
        <!-- Dashboard-Inhalt -->
        <div id="dashboard-content">
          <p>Willkommen zum YouTube Automation Tool!</p>
          <p>Dies ist eine Test-Version zum Testen des Layouts.</p>
          <p>Accentfarbe: #e39d4d</p>
        </div>
        
        <!-- Upload-Content (versteckt) -->
        <div id="upload-content" style="display: none;">
          <!-- Diese Form wird direkt in HTML definiert -->
          <div class="upload-form">
            <h2>Video auf YouTube hochladen</h2>
            
            <div class="form-section">
              <h3>1. Video ausw√§hlen</h3>
              <div class="file-drop-area" id="video-drop-area">
                <div class="file-message">Video hierher ziehen oder</div>
                <button id="select-video-btn" class="secondary-button">Video ausw√§hlen</button>
                <div id="selected-video-info" class="selected-file-info"></div>
              </div>
            </div>
            
            <div class="form-section">
              <h3>2. Video-Details</h3>
              <div class="form-group">
                <label for="video-title">Titel*</label>
                <input type="text" id="video-title" class="form-control" placeholder="Gib deinem Video einen Namen" required>
              </div>
              
              <div class="form-group">
                <label for="video-description">Beschreibung</label>
                <textarea id="video-description" class="form-control" rows="4" placeholder="Beschreibe dein Video (Unterst√ºtzt Links, Hashtags und Timestamps)"></textarea>
              </div>
              
              <div class="form-group">
                <label for="video-tags">Tags (mit Komma getrennt)</label>
                <input type="text" id="video-tags" class="form-control" placeholder="tag1, tag2, tag3">
              </div>
            </div>
            
            <div class="form-section">
              <h3>3. Thumbnail</h3>
              <div class="thumbnail-section">
                <div class="thumbnail-preview" id="thumbnail-preview">
                  <div class="thumbnail-placeholder">Keine Vorschau</div>
                </div>
                <button id="select-thumbnail-btn" class="secondary-button">Thumbnail ausw√§hlen</button>
              </div>
            </div>
            
            <div class="form-section">
              <h3>4. Einstellungen</h3>
              
              <div class="form-group">
                <label for="privacy-setting">Sichtbarkeit</label>
                <select id="privacy-setting" class="form-control">
                  <option value="private">Privat</option>
                  <option value="unlisted">Nicht gelistet</option>
                  <option value="public">√ñffentlich</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="video-category">Kategorie</label>
                <select id="video-category" class="form-control">
                  <option value="1">Film & Animation</option>
                  <option value="2">Autos & Fahrzeuge</option>
                  <option value="10">Musik</option>
                  <option value="15">Tiere</option>
                  <option value="17">Sport</option>
                  <option value="20">Gaming</option>
                  <option value="22" selected>Menschen & Blogs</option>
                  <option value="23">Kom√∂die</option>
                  <option value="24">Unterhaltung</option>
                  <option value="25">Nachrichten & Politik</option>
                  <option value="26">Praktische Tipps & Styling</option>
                  <option value="27">Bildung</option>
                  <option value="28">Wissenschaft & Technik</option>
                </select>
              </div>
              
              <div class="form-group checkbox-group">
                <label>
                  <input type="checkbox" id="made-for-kids" name="made-for-kids">
                  Dieses Video ist f√ºr Kinder gemacht
                </label>
              </div>
              
              <div class="form-group checkbox-group">
                <label>
                  <input type="checkbox" id="allow-comments" name="allow-comments" checked>
                  Kommentare erlauben
                </label>
              </div>
            </div>
            
            <div class="form-actions">
              <button id="cancel-upload-btn" class="cancel-button">Abbrechen</button>
              <button id="start-upload-btn" class="primary-button" disabled>Hochladen starten</button>
            </div>
          </div>
        </div>
        
        <!-- Settings-Content (versteckt) -->
        <div id="settings-content" style="display: none;">
          <div class="settings-page">
            <h2>YouTube API Einstellungen</h2>
            
            <div class="form-section">
              <div class="form-group">
                <label for="client-id">Client ID</label>
                <input type="text" id="client-id" class="form-control" placeholder="Google API Client ID">
              </div>
              
              <div class="form-group">
                <label for="client-secret">Client Secret</label>
                <input type="password" id="client-secret" class="form-control" placeholder="Google API Client Secret">
              </div>
              
              <div class="form-group">
                <label for="api-key">API Key</label>
                <input type="text" id="api-key" class="form-control" placeholder="Google API Key">
              </div>
              
              <button id="save-api-settings" class="primary-button">Einstellungen speichern</button>
            </div>
            
            <div class="form-section">
              <h3>YouTube Verbindung</h3>
              <div id="auth-status" class="auth-status">
                <div class="status-indicator disconnected"></div>
                <span>Nicht verbunden</span>
              </div>
              
              <button id="youtube-auth-btn" class="primary-button">Bei YouTube anmelden</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Status-Leiste -->
  <div class="status-bar">
    <div class="status-item">
      Bereit
    </div>
  </div>

  <script>
    // Globale Variablen f√ºr die Datei-Speicherung
    let videoFile = null;
    let thumbnailFile = null;
    
    document.addEventListener('DOMContentLoaded', () => {
      console.log('App gestartet!');
      
      // Navigation einrichten
      setupNavigation();
      
      // Upload-Button-Funktion
      setupUploadButton();
      
      // Event-Listener f√ºr Upload-Form
      setupUploadForm();
      
      // Event-Listener f√ºr Settings-Form
      setupSettingsForm();
    });
    
    function setupNavigation() {
      const sidebarItems = document.querySelectorAll('.sidebar-nav-item');
      const pageTitle = document.querySelector('.page-title');
      const dashboardContent = document.getElementById('dashboard-content');
      const uploadContent = document.getElementById('upload-content');
      const settingsContent = document.getElementById('settings-content');
      
      if (sidebarItems.length && pageTitle) {
        sidebarItems.forEach(item => {
          item.addEventListener('click', () => {
            // Aktiven Status umschalten
            sidebarItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            
            // Titel √§ndern
            const title = item.getAttribute('data-page');
            if (title) pageTitle.textContent = title;
            
            // Inhalte ein-/ausblenden basierend auf der Seite
            if (title === 'Settings') {
              dashboardContent.style.display = 'none';
              uploadContent.style.display = 'none';
              settingsContent.style.display = 'block';
            } else if (title === 'Upload') {
              dashboardContent.style.display = 'none';
              uploadContent.style.display = 'block';
              settingsContent.style.display = 'none';
            } else {
              dashboardContent.style.display = 'block';
              uploadContent.style.display = 'none';
              settingsContent.style.display = 'none';
            }
          });
        });
      }
      
      // Spezieller Event-Listener f√ºr Einstellungen-Icon
      const settingsNav = document.getElementById('settings-nav');
      if (settingsNav) {
        settingsNav.addEventListener('click', () => {
          sidebarItems.forEach(i => i.classList.remove('active'));
          settingsNav.classList.add('active');
          pageTitle.textContent = 'Settings';
          
          dashboardContent.style.display = 'none';
          uploadContent.style.display = 'none';
          settingsContent.style.display = 'block';
        });
      }
    }
    
    function setupUploadButton() {
      const newUploadBtn = document.getElementById('new-upload-btn');
      if (newUploadBtn) {
        newUploadBtn.addEventListener('click', () => {
          // Upload-Tab aktivieren
          const uploadNav = document.querySelector('.sidebar-nav-item[data-page="Upload"]');
          if (uploadNav) {
            uploadNav.click();
          }
        });
      }
    }
    
    // Event-Listener f√ºr Upload-Form
    function setupUploadForm() {
      const selectVideoBtn = document.getElementById('select-video-btn');
      const selectThumbnailBtn = document.getElementById('select-thumbnail-btn');
      const startUploadBtn = document.getElementById('start-upload-btn');
      const cancelUploadBtn = document.getElementById('cancel-upload-btn');
      const videoTitle = document.getElementById('video-title');
      const videoDropArea = document.getElementById('video-drop-area');
      
      // Video ausw√§hlen √ºber Dialog
      if (selectVideoBtn) {
        selectVideoBtn.addEventListener('click', async () => {
          try {
            console.log("Video ausw√§hlen geklickt");
            
            if (window.youtube && window.youtube.selectVideo) {
              console.log("youtube.selectVideo ist verf√ºgbar");
              const result = await window.youtube.selectVideo();
              
              if (!result.canceled) {
                console.log("Video ausgew√§hlt:", result);
                videoFile = {
                  name: result.fileName,
                  path: result.filePath
                };
                
                // Aktualisiere die UI
                const fileInfo = document.getElementById('selected-video-info');
                if (fileInfo) {
                  fileInfo.innerHTML = `
                    <div class="file-icon">üìπ</div>
                    <div class="file-details">
                      <div class="file-name">${videoFile.name}</div>
                      <div class="file-meta">${result.filePath}</div>
                    </div>
                  `;
                }
                
                // Upload-Button aktivieren wenn ein Titel eingegeben wurde
                if (startUploadBtn && videoTitle) {
                  startUploadBtn.disabled = !videoTitle.value.trim();
                }
              }
            } else {
              console.error("youtube.selectVideo ist NICHT verf√ºgbar");
              alert('Video-Auswahl-Funktion nicht verf√ºgbar - bitte √ºberpr√ºfen Sie die preload.js Datei.');
            }
          } catch (error) {
            console.error('Fehler bei der Video-Auswahl:', error);
            alert('Fehler bei der Video-Auswahl: ' + error.message);
          }
        });
      }
      
      // Video per Drag & Drop
      if (videoDropArea) {
        videoDropArea.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.stopPropagation();
          videoDropArea.classList.add('drag-over');
        });
        
        videoDropArea.addEventListener('dragleave', (e) => {
          e.preventDefault();
          e.stopPropagation();
          videoDropArea.classList.remove('drag-over');
        });
        
        videoDropArea.addEventListener('drop', (e) => {
          e.preventDefault();
          e.stopPropagation();
          videoDropArea.classList.remove('drag-over');
          
          if (e.dataTransfer.files.length > 0) {
            const file = e.dataTransfer.files[0];
            if (file.type.startsWith('video/')) {
              const fileSize = formatFileSize(file.size);
              
              videoFile = {
                name: file.name,
                path: file.path,
                size: fileSize,
                type: file.type
              };
              
              // Aktualisiere die UI
              const fileInfo = document.getElementById('selected-video-info');
              if (fileInfo) {
                fileInfo.innerHTML = `
                  <div class="file-icon">üìπ</div>
                  <div class="file-details">
                    <div class="file-name">${videoFile.name}</div>
                    <div class="file-meta">${videoFile.size}</div>
                  </div>
                `;
              }
              
              // Upload-Button aktivieren wenn ein Titel eingegeben wurde
              if (startUploadBtn && videoTitle) {
                startUploadBtn.disabled = !videoTitle.value.trim();
              }
            }
          }
        });
      }
      
      // Thumbnail ausw√§hlen
      if (selectThumbnailBtn) {
        selectThumbnailBtn.addEventListener('click', async () => {
          try {
            if (window.youtube && window.youtube.selectThumbnail) {
              const result = await window.youtube.selectThumbnail();
              
              if (!result.canceled) {
                thumbnailFile = {
                  name: result.fileName,
                  path: result.filePath
                };
                
                const thumbnailPreview = document.getElementById('thumbnail-preview');
                if (thumbnailPreview) {
                  thumbnailPreview.innerHTML = `
                    <div class="thumbnail-img">
                      <div class="placeholder-thumbnail" style="background-color: var(--accent-color);">
                        <span>Thumbnail: ${thumbnailFile.name}</span>
                      </div>
                    </div>
                  `;
                }
              }
            } else {
              alert('Thumbnail-Auswahl-Funktion nicht verf√ºgbar');
            }
          } catch (error) {
            console.error('Fehler beim Ausw√§hlen des Thumbnails:', error);
            alert('Fehler beim Ausw√§hlen des Thumbnails: ' + error.message);
          }
        });
      }
      
      // Upload-Button aktivieren, wenn Titel eingegeben wird
      if (videoTitle && startUploadBtn) {
        videoTitle.addEventListener('input', () => {
          startUploadBtn.disabled = !videoTitle.value.trim() || !videoFile;
        });
      }
      
      // Start-Upload-Button
      if (startUploadBtn) {
        startUploadBtn.addEventListener('click', async () => {
          if (!videoFile) {
            alert('Bitte w√§hle zuerst ein Video aus');
            return;
          }
          
          try {
            // Metadaten sammeln
            const metadata = {
              title: document.getElementById('video-title').value,
              description: document.getElementById('video-description').value,
              tags: document.getElementById('video-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
              privacy: document.getElementById('privacy-setting').value,
              categoryId: document.getElementById('video-category').value,
              madeForKids: document.getElementById('made-for-kids').checked,
              allowComments: document.getElementById('allow-comments').checked
            };
            
            console.log("Starte Upload mit:", {
              videoPath: videoFile.path,
              metadata: metadata
            });
            
            // Upload-Overlay anzeigen
            showUploadOverlay(videoFile);
            
            // Upload starten
            if (window.youtube && window.youtube.uploadVideo) {
              // Fortschritts-Callback registrieren
              const unsubscribe = window.youtube.onUploadProgress ? 
                window.youtube.onUploadProgress(progress => {
                  updateUploadProgress(progress);
                }) : null;
              
              // Video hochladen
              const result = await window.youtube.uploadVideo({
                videoPath: videoFile.path,
                metadata: metadata
              });
              
              console.log("Upload-Ergebnis:", result);
              
              if (result.success) {
                // Erfolg - Wenn Thumbnail vorhanden, lade es auch hoch
                if (thumbnailFile && window.youtube.uploadThumbnail) {
                  await window.youtube.uploadThumbnail({
                    videoId: result.videoId,
                    thumbnailPath: thumbnailFile.path
                  });
                }
                
                handleUploadSuccess(result.videoId);
              } else {
                throw new Error(result.error || 'Unbekannter Fehler beim Upload');
              }
              
              // Unsubscribe vom Fortschritts-Event
              if (unsubscribe) unsubscribe();
            } else {
              console.error("window.youtube.uploadVideo ist nicht verf√ºgbar");
              alert('Upload-Funktion nicht verf√ºgbar. Bitte √ºberpr√ºfen Sie die YouTube-API-Konfiguration.');
            }
          } catch (error) {
            console.error('Fehler beim Upload:', error);
            handleUploadError(error.message);
          }
        });
      }
      
      // Cancel-Button
      if (cancelUploadBtn) {
        cancelUploadBtn.addEventListener('click', () => {
          const dashboardNav = document.querySelector('.sidebar-nav-item[data-page="Dashboard"]');
          if (dashboardNav) {
            dashboardNav.click();
          }
        });
      }
    }
    
    // Event-Listener f√ºr Settings-Form
    function setupSettingsForm() {
      const saveApiSettingsBtn = document.getElementById('save-api-settings');
      const youtubeAuthBtn = document.getElementById('youtube-auth-btn');
      
      // API-Einstellungen laden
      loadApiSettings();
      
      // Speichern-Button
      if (saveApiSettingsBtn) {
        saveApiSettingsBtn.addEventListener('click', async () => {
          const clientId = document.getElementById('client-id').value;
          const clientSecret = document.getElementById('client-secret').value;
          const apiKey = document.getElementById('api-key').value;
          
          try {
            if (window.app && window.app.saveApiConfig) {
              console.log("Speichere API-Einstellungen:", { clientId, clientSecret, apiKey });
              const result = await window.app.saveApiConfig({ clientId, clientSecret, apiKey });
              console.log("Ergebnis:", result);
              
              if (result.success) {
                alert('API-Einstellungen erfolgreich gespeichert!');
              } else {
                alert(`Fehler beim Speichern der API-Einstellungen: ${result.error}`);
              }
            } else {
              console.error("window.app.saveApiConfig ist nicht verf√ºgbar");
              alert('Die Funktion zum Speichern der API-Einstellungen ist nicht verf√ºgbar.');
            }
          } catch (error) {
            console.error('Fehler beim Speichern der API-Einstellungen:', error);
            alert('Ein Fehler ist aufgetreten. Bitte versuche es erneut.');
          }
        });
      }
      
      // YouTube Authentifizieren-Button
      if (youtubeAuthBtn) {
        youtubeAuthBtn.addEventListener('click', async () => {
          try {
            if (window.youtube && window.youtube.authenticate) {
              console.log("Starte YouTube-Authentifizierung");
              const result = await window.youtube.authenticate();
              console.log("Auth-Ergebnis:", result);
              
              if (result && result.success) {
                alert('Erfolgreich bei YouTube angemeldet!');
                updateAuthStatus();
              } else {
                alert(`Authentifizierung fehlgeschlagen: ${result?.error || 'Unbekannter Fehler'}`);
              }
            } else {
              console.error("window.youtube.authenticate ist nicht verf√ºgbar");
              alert('Die YouTube-Authentifizierungsfunktion ist nicht verf√ºgbar.');
            }
          } catch (error) {
            console.error('Fehler bei der YouTube-Authentifizierung:', error);
            alert('Ein Fehler ist aufgetreten. Bitte versuche es erneut.');
          }
        });
      }
    }
    
    // API-Einstellungen laden
    async function loadApiSettings() {
      try {
        const clientIdInput = document.getElementById('client-id');
        const clientSecretInput = document.getElementById('client-secret');
        const apiKeyInput = document.getElementById('api-key');
        
        if (window.app && window.app.getApiSettings) {
          console.log("Lade API-Einstellungen...");
          const settings = await window.app.getApiSettings();
          console.log("API-Einstellungen geladen:", settings);
          
          if (clientIdInput) clientIdInput.value = settings.clientId || '';
          if (clientSecretInput) clientSecretInput.value = settings.clientSecret || '';
          if (apiKeyInput) apiKeyInput.value = settings.apiKey || '';
        } else {
          console.error("window.app.getApiSettings ist nicht verf√ºgbar");
        }
        
        // Pr√ºfen, ob wir bereits authentifiziert sind
        updateAuthStatus();
      } catch (error) {
        console.error('Fehler beim Laden der API-Einstellungen:', error);
      }
    }
    
    // Auth-Status aktualisieren
    async function updateAuthStatus() {
      const authStatus = document.getElementById('auth-status');
      const youtubeAuthBtn = document.getElementById('youtube-auth-btn');
      
      if (authStatus && youtubeAuthBtn) {
        try {
          if (window.youtube && window.youtube.checkAuth) {
            console.log("Pr√ºfe Auth-Status...");
            const isAuthenticated = await window.youtube.checkAuth();
            console.log("Auth-Status:", isAuthenticated);
            
            if (isAuthenticated) {
              authStatus.innerHTML = `
                <div class="status-indicator connected"></div>
                <span>Mit YouTube verbunden</span>
              `;
              youtubeAuthBtn.textContent = 'Verbindung trennen';
            } else {
              authStatus.innerHTML = `
                <div class="status-indicator disconnected"></div>
                <span>Nicht verbunden</span>
              `;
              youtubeAuthBtn.textContent = 'Bei YouTube anmelden';
            }
          } else {
            console.error("window.youtube.checkAuth ist nicht verf√ºgbar");
          }
        } catch (error) {
          console.error('Fehler beim Pr√ºfen des Authentifizierungsstatus:', error);
        }
      }
    }

    // Upload-Overlay anzeigen
    function showUploadOverlay(videoFile) {
      // Erstelle Upload-Overlay dynamisch
      const overlay = document.createElement('div');
      overlay.className = 'upload-overlay';
      overlay.id = 'upload-overlay';
      overlay.innerHTML = `
        <div class="overlay-container">
          <div class="overlay-close" id="overlay-close">√ó</div>
          <h2>Uploading to YouTube</h2>
          
          <div class="progress-section">
            <div class="progress-circle">
              <svg class="progress-svg" viewBox="0 0 100 100">
                <circle class="progress-circle-bg" cx="50" cy="50" r="48"></circle>
                <circle class="progress-circle-fill" cx="50" cy="50" r="48"></circle>
              </svg>
              <div class="progress-percentage">0%</div>
            </div>
            
            <div class="progress-details">
              <div class="upload-file">${videoFile.name}</div>
              <div class="upload-status">Uploading...</div>
              <div class="upload-time">Initialisiere...</div>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
      
      // "X" zum Schlie√üen
      const closeBtn = document.getElementById('overlay-close');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          // Frage, ob der Upload wirklich abgebrochen werden soll
          if (confirm('M√∂chtest du den Upload wirklich abbrechen?')) {
            cancelUpload();
          }
        });
      }
    }

    // Upload-Fortschritt aktualisieren
    function updateUploadProgress(progress) {
      const progressCircle = document.querySelector('.progress-circle-fill');
      const progressText = document.querySelector('.progress-percentage');
      const uploadStatus = document.querySelector('.upload-status');
      const uploadTime = document.querySelector('.upload-time');
      
      if (progressCircle && progressText) {
        const dashOffset = 301 - (301 * progress.progress / 100);
        progressCircle.style.strokeDashoffset = dashOffset;
        progressText.textContent = `${progress.progress}%`;
        
        if (uploadStatus && progress.status) {
          uploadStatus.textContent = progress.status;
        }
        
        if (uploadTime && progress.timeRemaining) {
          uploadTime.textContent = progress.timeRemaining;
        }
        
        // Bei 100% zeige "Verarbeitung..." an
        if (progress.progress >= 100 && uploadStatus) {
          uploadStatus.textContent = 'Verarbeitung...';
          if (uploadTime) {
            uploadTime.textContent = 'Das Video wird von YouTube verarbeitet';
          }
        }
      }
    }

    // Upload-Erfolg behandeln
    function handleUploadSuccess(videoId) {
      const overlay = document.getElementById('upload-overlay');
      if (overlay) {
        const overlayContainer = overlay.querySelector('.overlay-container');
        if (overlayContainer) {
          overlayContainer.innerHTML = `
            <h2>Upload erfolgreich!</h2>
            <div class="success-animation">
              <div class="success-checkmark">‚úì</div>
            </div>
            <p>Dein Video wurde erfolgreich hochgeladen und ist jetzt auf YouTube verf√ºgbar.</p>
            <div class="success-actions">
              <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" class="primary-button">Video ansehen</a>
              <button id="success-close" class="secondary-button">Schlie√üen</button>
            </div>
          `;
          
          // Event-Listener f√ºr den Schlie√üen-Button
          const successCloseBtn = document.getElementById('success-close');
          if (successCloseBtn) {
            successCloseBtn.addEventListener('click', () => {
              if (overlay) {
                overlay.remove();
              }
              resetUploadForm();
            });
          }
        }
      }
    }

    // Upload-Fehler behandeln
    function handleUploadError(errorMessage) {
      const overlay = document.getElementById('upload-overlay');
      if (overlay) {
        const overlayContainer = overlay.querySelector('.overlay-container');
        if (overlayContainer) {
          overlayContainer.innerHTML = `
            <h2>Upload fehlgeschlagen</h2>
            <div class="error-animation">
              <div class="error-icon">!</div>
            </div>
            <p>Beim Hochladen deines Videos ist ein Fehler aufgetreten:</p>
            <div class="error-message">${errorMessage}</div>
            <div class="error-actions">
              <button id="try-again" class="primary-button">Erneut versuchen</button>
              <button id="error-close" class="secondary-button">Abbrechen</button>
            </div>
          `;
          
          // Event-Listener f√ºr den Erneut-versuchen-Button
          const tryAgainBtn = document.getElementById('try-again');
          if (tryAgainBtn) {
            tryAgainBtn.addEventListener('click', () => {
              if (overlay) {
                overlay.remove();
              }
              // Erneut versuchen - Button "Hochladen starten" klicken
              document.getElementById('start-upload-btn').click();
            });
          }
          
          // Event-Listener f√ºr den Schlie√üen-Button
          const errorCloseBtn = document.getElementById('error-close');
          if (errorCloseBtn) {
            errorCloseBtn.addEventListener('click', () => {
              if (overlay) {
                overlay.remove();
              }
            });
          }
        }
      }
    }

    // Upload abbrechen
    function cancelUpload() {
      const overlay = document.getElementById('upload-overlay');
      if (overlay) {
        overlay.remove();
      }
    }

    // Upload-Formular zur√ºcksetzen
    function resetUploadForm() {
      // Gehe zur√ºck zum Dashboard
      const dashboardNav = document.querySelector('.sidebar-nav-item[data-page="Dashboard"]');
      if (dashboardNav) {
        dashboardNav.click();
      }
      
      // Formularfelder zur√ºcksetzen
      document.getElementById('video-title').value = '';
      document.getElementById('video-description').value = '';
      document.getElementById('video-tags').value = '';
      document.getElementById('privacy-setting').value = 'private';
      document.getElementById('video-category').value = '22';
      document.getElementById('made-for-kids').checked = false;
      document.getElementById('allow-comments').checked = true;
      
      // Datei-Auswahl zur√ºcksetzen
      const fileInfo = document.getElementById('selected-video-info');
      if (fileInfo) {
        fileInfo.innerHTML = '';
      }
      
      const thumbnailPreview = document.getElementById('thumbnail-preview');
      if (thumbnailPreview) {
        thumbnailPreview.innerHTML = `<div class="thumbnail-placeholder">Keine Vorschau</div>`;
      }
      
      // Upload-Button deaktivieren
      const startUploadBtn = document.getElementById('start-upload-btn');
      if (startUploadBtn) {
        startUploadBtn.disabled = true;
      }
      
      // Globale Variablen zur√ºcksetzen
      videoFile = null;
      thumbnailFile = null;
    }

    // Hilfsfunktion: Dateigr√∂√üe formatieren
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>